(function ( ) {
  'use strict';

  var async = require('async');
  var exec  = require('child_process').exec;

  /*
   * To execute multiple commands. Invokes provided callback with
   * results/error when done.
   *
   * Parameters:
   *    ([, arg1[, arg2[, ...]]], callback);
   *
   * Example:
   *    require('execute.js')('ffmpeg -i audio.mp3 -o audio.ogg', 'aws s3 sync S3://dir .', callback)
   */
  module.exports = function ( ) {

	// turn each argument into a function where the argument is the command to execute
    var commands  = Array.prototype.slice.call(arguments, 0, arguments.length - 1).map(execute);
    var done      = Array.prototype.slice.call(arguments).pop( );

	if (typeof done !== 'function') {
		throw new Error('NoCallbackException');
	}

    function execute (cmd) {
      return function (cb) {
        exec(cmd, cb);
      };
    }

    async.series(commands, done);
  };

}( ));
